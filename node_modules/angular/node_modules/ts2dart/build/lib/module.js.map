{"version":3,"sources":["module.ts"],"names":["ImportExportTranspiler","ImportExportTranspiler.constructor","ImportExportTranspiler.visitNode","ImportExportTranspiler.isIgnoredImport","ImportExportTranspiler.visitExternalModuleReferenceExpr","ImportExportTranspiler.isEmptyImport","ImportExportTranspiler.filterImports"],"mappings":"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","file":"module.js","sourceRoot":"/Users/vsavkin/projects/ts2dart/","sourcesContent":["/// <reference path='../node_modules/typescript/bin/typescript.d.ts' />\nimport ts = require('typescript');\nimport base = require('./base');\nimport ts2dart = require('./main');\n\nclass ImportExportTranspiler extends base.TranspilerStep {\n  constructor(tr: ts2dart.Transpiler, private generateLibraryName: boolean) { super(tr); }\n\n  visitNode(node: ts.Node): boolean {\n    switch (node.kind) {\n      case ts.SyntaxKind.SourceFile:\n        if (this.generateLibraryName) {\n          this.emit('library');\n          this.emit(this.getLibraryName());\n          this.emit(';');\n        }\n        ts.forEachChild(node, this.visit.bind(this));\n        break;\n      case ts.SyntaxKind.EndOfFileToken:\n        ts.forEachChild(node, this.visit.bind(this));\n        break;\n      case ts.SyntaxKind.ImportDeclaration:\n        var importDecl = <ts.ImportDeclaration>node;\n        if (this.isEmptyImport(importDecl)) return true;\n        this.emit('import');\n        this.visitExternalModuleReferenceExpr(importDecl.moduleSpecifier);\n        if (importDecl.importClause) {\n          this.visit(importDecl.importClause);\n        } else {\n          this.reportError(importDecl, 'bare import is unsupported');\n        }\n        this.emit(';');\n        break;\n      case ts.SyntaxKind.ImportClause:\n        var importClause = <ts.ImportClause>node;\n        if (importClause.name) this.visitTypeName(importClause.name);\n        if (importClause.namedBindings) {\n          this.visit(importClause.namedBindings);\n        }\n        break;\n      case ts.SyntaxKind.NamespaceImport:\n        var nsImport = <ts.NamespaceImport>node;\n        this.emit('as');\n        this.visitTypeName(nsImport.name);\n        break;\n      case ts.SyntaxKind.NamedImports:\n        this.emit('show');\n        var used = this.filterImports((<ts.NamedImports>node).elements);\n        if (used.length === 0) {\n          this.reportError(node, 'internal error, used imports must not be empty');\n        }\n        this.visitList(used);\n        break;\n      case ts.SyntaxKind.NamedExports:\n        this.emit('show');\n        this.visitList((<ts.NamedExports>node).elements);\n        break;\n      case ts.SyntaxKind.ImportSpecifier:\n      case ts.SyntaxKind.ExportSpecifier:\n        var spec = <ts.ImportOrExportSpecifier>node;\n        if (spec.propertyName) this.visitTypeName(spec.propertyName);\n        this.visitTypeName(spec.name);\n        break;\n      case ts.SyntaxKind.ExportDeclaration:\n        var exportDecl = <ts.ExportDeclaration>node;\n        this.emit('export');\n        if (exportDecl.moduleSpecifier) {\n          this.visitExternalModuleReferenceExpr(exportDecl.moduleSpecifier);\n        } else {\n          this.reportError(node, 're-exports must have a module URL (export x from \"./y\").');\n        }\n        if (exportDecl.exportClause) this.visit(exportDecl.exportClause);\n        this.emit(';');\n        break;\n      case ts.SyntaxKind.ImportEqualsDeclaration:\n        var importEqDecl = <ts.ImportEqualsDeclaration>node;\n        this.emit('import');\n        this.visit(importEqDecl.moduleReference);\n        this.emit('as');\n        this.visitTypeName(importEqDecl.name);\n        this.emit(';');\n        break;\n      case ts.SyntaxKind.ExternalModuleReference:\n        this.visitExternalModuleReferenceExpr((<ts.ExternalModuleReference>node).expression);\n        break;\n\n      default:\n        return false;\n    }\n    return true;\n  }\n\n  private static isIgnoredImport(e: ts.ImportSpecifier) {\n    var name = base.ident(e.name);\n    switch (name) {\n      case 'CONST':\n      case 'CONST_EXPR':\n      case 'ABSTRACT':\n      case 'IMPLEMENTS':\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  private visitExternalModuleReferenceExpr(expr: ts.Expression) {\n    // TODO: what if this isn't a string literal?\n    var moduleName = <ts.StringLiteral>expr;\n    var text = moduleName.text;\n    if (text.match(/^\\.\\//)) {\n      // Strip './' to be more Dart-idiomatic.\n      text = text.substring(2);\n    } else if (!text.match(/^\\.\\.\\//)) {\n      // Unprefixed imports are package imports.\n      text = 'package:' + text;\n    }\n    moduleName.text = text + '.dart';\n    this.visit(expr);\n  }\n\n  private isEmptyImport(n: ts.ImportDeclaration): boolean {\n    var bindings = n.importClause.namedBindings;\n    if (bindings.kind != ts.SyntaxKind.NamedImports) return false;\n    return (<ts.NamedImports>bindings).elements.every(ImportExportTranspiler.isIgnoredImport);\n  }\n\n  private filterImports(ns: ts.ImportOrExportSpecifier[]) {\n    return ns.filter((e) => !ImportExportTranspiler.isIgnoredImport(e));\n  }\n}\n\nexport = ImportExportTranspiler;\n"]}